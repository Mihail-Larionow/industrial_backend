# Вычислятор

Приложение, которое принимает на вход список инструкций:

- `calc` - вычислить арифметическую операцию (умножение, сложение, вычитание) над двумя
  сущностями и сохранить результат в переменную,

- `print` - вывести значение переменной.

_Swagger_-документацию данного сервиса можно найти [здесь](http://130.193.58.208:8080/swagger)

## Установка

Первым делом необходимо склонировать репозиторий:

```bash
git clone https://github.com/Mihail-Larionow/industrial_backend.git
```

Затем запустить приложение при помощи `docker-compose` конфигурации:

```bash
cd industrial_backend
docker-compose -f build/docker-compose.yaml up
```

После чего сервис будет доступен для HTTP по адресу `http://localhost:8080` и для gRPC по адресу `localhost:9090`

## О проекте

### Архитектура

```
├── api/                   # Интерфейсы взаимодействия
│   └── proto/             # Протофайлы
│
├── build/                 # Конфигурационные файлы деплоя
│
├── cmd/                   # Точки входа в приложение
│   └── api/               # Основные исполняемые файлы
│
├── config/                # Конфигурационные файлы сервиса
│
├── internal/              # Внутренние пакеты
│   ├── app/               # Инициализация приложения
│   ├── config/            # Обработка конфигов
│   ├── handler/           # Обработчики
│   ├── repository/        # Репозитории
│   ├── server/            # Инициализация и запуск обработчиков
│   └── service/           # Бизнес-логика приложения
│
└── docs/                  # Документация
```

<p align="right"><i>
Изначально опирался на <a href="https://github.com/golang-standards/project-layout">golang-standards</a>
</i></p>

### Ручки

Для выполнения инструкций через HTTP, отправьте POST-запрос на `/execute` с телом запроса в формате JSON:

```json
[
	{ "type": "calc", "op": "+", "var": "x", "left": 1, "right": 2 },
	{ "type": "print", "var": "x" }
]
```

А для выполнения инструкций через gRPC, отправьте protobuf-сообщение.

<p align="right"><i>Для тестирования были использованы Postman и BloomRPC</i></p>

### Бизнес-логика

Основаня логика сервиса реализована в файле `calculator_service.go`.

Для оптимизации обработки запросов был добавлен `DependencyGraph`, хранящий в себе зависимости между переменными, что позволило выполнять независимые вычисления параллельно.

А для обеспечения безопасного доступа к результатам вычислений использован `sync.RWMutex`.

### Покрытие тестами

<table style="width: 100%;">
  <thead>
    <tr>
      <th>Пакет</th>
      <th>Значение</th>
    </tr>
  </thead>
  <tbody>
    <tr><td><code>internal/handler</code></td><td><strong>90.9%</strong></td></tr>
    <tr><td><code>internal/service</code></td><td><strong>87.3%</strong></td></tr>
    <tr><td>Итого</td><td><strong>36.6%</strong></td></tr>
  </tbody>
</table>

## Деплой

Данный сервис запущен в Яндекс Облаке и доступен по IP-адресу [130.193.58.208](http://130.193.58.208:8080/swagger)
